# ECRM 服装总代理销售报表系统接口文档（第一阶段）

## 1. 用户管理模块

### 1.1 用户注册

- **接口地址**：`/api/user/register`

- **请求方法**：`POST`

- **请求参数**：

  | 参数名   | 类型   | 描述   | 是否必填 |            |
  | -------- | ------ | ------ | -------- | ---------- |
  | username | String | 用户名 | 是       | 5-16位字符 |
  | password | String | 密码   | 是       | 5-16位字符 |
  | email    | String | 邮箱   | 是       |            |
  | phone    | String | 电话   | 是       |            |

- **返回参数**：

  | 参数名  | 类型   | 描述                               |
  | ------- | ------ | ---------------------------------- |
  | code    | Number | 状态码，200 表示成功，其他表示失败 |
  | message | String | 提示信息                           |
  | data    | Object | 返回的数据                         |

### 1.2 用户登录

- **接口地址**：`/api/user/login`

- **请求方法**：`POST`

- **请求参数**：

  | 参数名   | 类型   | 描述   | 是否必填 |
  | -------- | ------ | ------ | -------- |
  | username | String | 用户名 | 是       |
  | password | String | 密码   | 是       |

- **返回参数**：

  | 参数名  | 类型   | 描述                               |
  | ------- | ------ | ---------------------------------- |
  | code    | Number | 状态码，200 表示成功，其他表示失败 |
  | message | String | 提示信息                           |
  | data    | Object | 返回的数据                         |
  | token   | String | JWT Token                          |

### 1.3 权限管理

- **接口地址**：`/api/user/permission`

- **请求方法**：`POST`

- **请求参数**：

  | 参数名 | 类型   | 描述                                              | 是否必填 |
  | ------ | ------ | ------------------------------------------------- | -------- |
  | userid | String | 用户 ID                                           | 是       |
  | role   | String | 角色，如 admin sales operator external employee等 | 是       |

- **返回参数**：

  | 参数名  | 类型   | 描述                               |
  | ------- | ------ | ---------------------------------- |
  | code    | Number | 状态码，200 表示成功，其他表示失败 |
  | message | String | 提示信息                           |

### 1.4 个人中心 - 修改密码

- **接口地址**：`/api/user/changePassword`

- **请求方法**：`POST`

- 请求头

  | 字段          | 必填 |                               |
  | ------------- | ---- | ----------------------------- |
  | Authorization | 是   | Bearer 空格 + 登录返回的token |

  

- **请求参数**：

  | 参数名      | 类型   | 描述   | 是否必填 |
  | ----------- | ------ | ------ | -------- |
  | oldPassword | String | 旧密码 | 是       |
  | newPassword | String | 新密码 | 是       |
  
- **返回参数**：

  | 参数名  | 类型   | 描述                               |
  | ------- | ------ | ---------------------------------- |
  | code    | Number | 状态码，200 表示成功，其他表示失败 |
  | message | String | 提示信息                           |
  | data    | Object | 返回的数据                         |

## 2. 客户管理模块

### 2.1 客户查询

- **请求 URL**: `/api/customers/query`
- **请求方法**: `GET`
- **请求参数**:（c_client_vip表）

| 参数名         | 类型    | 是否必填 | 描述                                        | 示例值                  |
| -------------- | ------- | -------- | ------------------------------------------- | ----------------------- |
| `pageNum`      | Integer | 否       | 页码，默认值为 1                            | 1                       |
| `pageSize`     | Integer | 否       | 每页数量，默认值为 20                       | 20                      |
| `cardNo`       | String  | 否       | VIP 卡号（支持模糊查询）                    | "VIP2025001"            |
| `vipName`      | String  | 否       | 客户姓名（支持模糊查询）                    | "张三"                  |
| `idNo`         | String  | 否       | 证件号（精确匹配）                          | "310101199001011234"    |
| c_vipType_Id   | String  | 否       | VIP 类型 ID                                 | "GOLD"                  |
| `vipStatus`    | String  | 否       | VIP 状态（1 = 有效，0 = 无效）              | "1"                     |
| `storeId`      | String  | 否       | 所属门店 ID                                 | "SH001"                 |
| `creationDate` | String  | 否       | 创建日期范围（格式：YYYY-MM-DD,YYYY-MM-DD） | "2025-01-01,2025-07-18" |

#### 3. 响应信息

- **成功响应示例**:

json

```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "total": 15,
    "pageNum": 1,
    "pageSize": 10,
    "list": [
      {
        // 基础审计字段
        "id": "CUST0001",
        "adClientId": "CLIENT001",
        "adOrgId": "ORG001",
        "isActive": "Y",
        "modifierId": "USER001",
        "creationDate": "2025-01-10 10:30:00",
        "modifiedDate": "2025-07-15 15:45:00",
        "ownerId": "USER001",
        
        // 会员身份与类型
        "cardNo": "VIP20250001",
        "vipTypeId": "GOLD",
        "idNo": "310101199001011234",
        "vipName": "张三",
        "vipEname": "Zhang San",
        "sex": "男",
        "birthday": "1990-01-01",
        "validDate": "2026-01-10",
        
        // 积分与财务
        "creditRemain": 3500,
        "integral": 12000,
        "integralUp": "+500",
        "expireIntegral": 2000,
        "expireDate": "2025-12-31",
        
        // 联系与地址
        "country": "中国",
        "cCityId": "SH",
        "address": "上海市浦东新区XX路XX号",
        "post": "200120",
        "phone": "021-12345678",
        "mobil": "13812345678",
        "email": "zhangsan@example.com",
        
        // 业务关联
        "cStoreId": "SH001",
        "cCustomerId": "CUS001",
        "cCustomerUpId": "CUS000",
        "mRetailNo": "RT20250001",
        "cOldVipId": null,
        "cOpenCardTypeId": "ONLINE",
        
        // 会员状态与开卡
        "vipState": "NORMAL",
        "enterType": "NEW",
        "openCardStatus": "1",
        "openCardId": "OC20250001",
        "openCardTime": "2025-01-10 10:30:00",
        "isFirstInter": "Y",
        "vipStatus": "1",
        
        // 扩展属性
        "bestTime": "晚上7点后",
        "babyName": "张小明",
        "education": "本科",
        "hmonIncome": "20-30万",
        "infSource": "公众号",
        "wechatUnionId": "oABC123xyz",
        "openId": "oABC123",
        "checkCode": "E5F8A2D1"
      }
    ]
  }
}
```

- **错误响应示例**:

json

```json
{
  "code": 400,
  "message": "参数错误：pageSize不能大于100",
  "data": null
}
```

### 2.2 客户录入

- **接口地址**：`/api/customer/add

- **请求方法**：POST

- 请求体格式：JSON（c_client_vip表）

  | 参数分类       | 字段名          | 数据类型 | 是否必填 | 说明（默认值 / 规则）                               | 示例值                 |
  | -------------- | --------------- | -------- | -------- | --------------------------------------------------- | ---------------------- |
  | 会员身份与类型 | cardNo          | String   | 否       | VIP 卡号（为空时系统自动生成：VIP + 日期 + 序号）   | "VIP20250720001"       |
  |                | vipTypeId       | String   | 是       | VIP 类型 ID（关联类型表，如普通 / 金卡）            | "TYPE_GOLD"            |
  |                | idNo            | String   | 是       | 证件号（身份证 / 护照，唯一校验）                   | "310101199001011234"   |
  |                | vipName         | String   | 是       | 客户姓名（2-20 字符）                               | "张三"                 |
  |                | vipEname        | String   | 否       | 英文名（国际化场景）                                | "Zhang San"            |
  |                | sex             | String   | 否       | 性别（仅支持 “男”“女”）                             | "男"                   |
  |                | birthday        | String   | 否       | 生日（格式：yyyy-MM-dd）                            | "1990-01-01"           |
  |                | validDate       | String   | 否       | 会员有效期（默认当前日期 + 1 年，格式：yyyy-MM-dd） | "2026-07-20"           |
  | 积分与财务     | creditRemain    | Integer  | 否       | 剩余积分（默认 0）                                  | 1000                   |
  |                | integral        | Integer  | 否       | 总积分（默认与剩余积分一致）                        | 1000                   |
  |                | integralUp      | String   | 否       | 积分变动说明（如 “开卡赠分”）                       | "+1000"                |
  |                | expireIntegral  | Integer  | 否       | 过期积分（默认 0）                                  | 0                      |
  |                | expireDate      | String   | 否       | 积分过期日期（格式：yyyy-MM-dd）                    | "2025-12-31"           |
  | 联系与地址     | country         | String   | 否       | 国家（默认 “中国”）                                 | "中国"                 |
  |                | cCityId         | String   | 否       | 城市 ID（关联城市表）                               | "CITY_SH"              |
  |                | address         | String   | 否       | 详细地址（最多 100 字符）                           | "上海市浦东新区 XX 路" |
  |                | post            | String   | 否       | 邮编（6 位数字）                                    | "200120"               |
  |                | phone           | String   | 否       | 固定电话（格式：区号 - 号码）                       | "021-12345678"         |
  |                | mobil           | String   | 是       | 手机号（11 位数字，唯一校验）                       | "13812345678"          |
  |                | email           | String   | 否       | 邮箱（格式校验：xxx@xxx.xxx）                       | "zhangsan@example.com" |
  | 业务关联       | cStoreId        | String   | 否       | 所属门店 ID（关联门店表）                           | "STORE001"             |
  |                | cCustomerUpId   | String   | 否       | 上级客户 ID（推荐人，构建关系链）                   | "VIP202500001"         |
  |                | cOpenCardTypeId | String   | 否       | 开卡类型 ID（线上 / 线下，默认 “TYPE_OFFLINE”）     | "TYPE_ONLINE"          |
  | 会员状态与开卡 | vipState        | String   | 否       | VIP 状态（默认 “正常”，可选 “冻结”）                | "正常"                 |
  |                | isFirstInter    | String   | 否       | 是否首次互动（默认 “N”，首次接触后更新为 “Y”）      | "N"                    |

  #### 三、响应参数

  **成功响应（状态码：201）**：

  json

  ```json
  {
    "code": 201,
    "message": "VIP客户创建成功",
    "data": {
      "id": "VIP20250720001",  // 系统生成的主键ID（唯一标识）
      "cardNo": "VIP20250720001",  // VIP卡号（传入或生成值）
      "creationDate": "2025-07-20 10:30:00",  // 记录创建时间（系统自动生成）
      "checkCode": "A1B2C3D4"  // 数据校验码（防篡改，系统生成）
    }
  }
  ```

  **错误响应（状态码：400）**：

  json

  ```json
  {
    "code": 400,
    "message": "参数错误",
    "errors": {
      "idNo": "证件号已被使用",  // 具体错误字段及原因
      "mobil": "手机号格式不正确（需11位数字）"
    }
  }
  ```

### 2.3 客户分类

#### 2.3.1 客户分类新增

**URL**：`/api/vip-type/create`
**方法**：`POST`

#### **请求体（JSON）**(C_VIPTYPE)

| 参数名          | 类型    | 必填 | 说明                                        | 关联字段（`C_VIPTYPE`） |
| --------------- | ------- | ---- | ------------------------------------------- | ----------------------- |
| `name`          | string  | ✔️    | VIP 类型名称（如 “金卡会员”）               | `NAME`                  |
| `description`   | string  |      | 类型规则描述（如 “享 8 折 + 生日双倍积分”） | `DESCRIPTION`           |
| `discount`      | decimal | ✔️    | 基础折扣率（如`0.8`=8 折）                  | `DISCOUNT`              |
| `integralRate`  | decimal | ✔️    | 消费积分比例（1 元 = 1 积分传`1`）          | `INTEGRALRATE`          |
| `canUpgrade`    | string  | ✔️    | 是否可升级（`Y`= 允许，`N`= 禁止）          | `CANUPGRADE`            |
| `vipTypeUpId`   | number  |      | 升级目标类型 ID（指向本表，如金卡→钻石卡）  | `C_VIPTYPEUP_ID`        |
| `needIntg`      | number  |      | 开通需消耗积分                              | `NEEDINTG`              |
| `defaultValid`  | string  | ✔️    | 开通是否默认有效（`Y`= 生效）               | `DEFAULTVALID`          |
| `dbIntDay`      | number  |      | 有效期（天数，如`365`=1 年）                | `DBINTDAY`              |
| `integralValid` | number  |      | 积分有效期（天数）                          | `INTEGRAL_VALID`        |
| `isActive`      | string  | ✔️    | 是否启用（`Y`= 生效，`N`= 暂停）            | `ISACTIVE`              |

#### **响应示例**

json

```json
{
  "code": 200,
  "msg": "VIP类型创建成功",
  "data": {
    "typeId": 1001  // 新增类型ID，关联`ID`
  }
}
```

#### 2.3.2  **查询 VIP 分类**

**URL**：`/api/vip-type/{typeId}`
**方法**：`GET`

#### **路径参数**

| 参数名   | 类型   | 说明                |
| -------- | ------ | ------------------- |
| `typeId` | number | VIP 类型 ID（必填） |

#### **响应示例**

json

```json
{
  "code": 200,
  "msg": "查询成功",
  "data": {
    "id": 1001,
    "name": "金卡会员",
    "discount": 0.8,
    "integralRate": 1,
    "canUpgrade": "Y",
    "dbIntDay": 365,
    "isActive": "Y"
    // 其他规则字段按需返回...
  }
}
```

#### 2.3.3 **更新 VIP 分类规则**

**URL**：`/api/vip-type/{typeId}`
**方法**：`PUT`

#### **路径参数**

| 参数名   | 类型   | 说明                |
| -------- | ------ | ------------------- |
| `typeId` | number | VIP 类型 ID（必填） |

#### **请求体（JSON）**

同 **创建接口**（按需修改字段，如更新`discount`为`0.75`）

#### **响应示例**

json

```json
{
  "code": 200,
  "msg": "VIP类型规则更新成功",
  "data": {}
}
```

#### 2.3.4 **删除 VIP 分类**

**URL**：`/api/vip-type/{typeId}/disable`
**方法**：`POST`

#### **路径参数**

| 参数名   | 类型   | 说明                |
| -------- | ------ | ------------------- |
| `typeId` | number | VIP 类型 ID（必填） |

#### **响应示例**

json

```json
{
  "code": 200,
  "msg": "VIP类型已暂停（逻辑删除）",
  "data": {
    "isActive": "N"  // 状态更新
  }
}
```

###  2.4 客户跟进

- **接口地址**：`/api/customer/followup`

- **请求方法**：`POST`

- **业务关联表**：可落地至`CVIP_FEEDBACK`（或类似客户反馈 / 跟进表 ，利用`VALUE`存跟进内容、`AD_CLIENT_ID`关联租户 ）

- 请求参数

  | 参数名            | 类型   | 描述     | 是否必填 | 表字段映射参考              |
  | ----------------- | ------ | -------- | -------- | --------------------------- |
  | `customerId`      | String | 客户 ID  | 是       | 关联表中`ID`/`AD_CLIENT_ID` |
  | `followupContent` | String | 跟进内容 | 是       | 存入表中`VALUE`/`NAME`字段  |

- 返回参数

  | 参数名    | 类型   | 描述                               |
  | --------- | ------ | ---------------------------------- |
  | `code`    | Number | 状态码，200 表示成功，其他表示失败 |
  | `message` | String | 提示信息                           |
  | `data`    | Object | 可返回跟进记录 ID 等数据           |

### 2.5 客户画像

- **接口地址**：`/api/customer/profile`

- **请求方法**：`GET`

- **请求参数**：

  | 参数名     | 类型   | 描述    | 是否必填 |
  | ---------- | ------ | ------- | -------- |
  | customerId | String | 客户 ID | 是       |

- **返回参数**：

  | 参数名  | 类型   | 描述                               |
  | ------- | ------ | ---------------------------------- |
  | code    | Number | 状态码，200 表示成功，其他表示失败 |
  | message | String | 提示信息                           |
  | data    | Object | 客户画像信息                       |